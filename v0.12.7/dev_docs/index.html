<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>For developers · Enzyme.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://enzyme.mit.edu/julia/dev_docs/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><script src="https://plausible.io/js/plausible.js" data-domain="enzyme.mit.edu" defer></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Enzyme.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">Enzyme.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../generated/autodiff/">Basics</a></li><li><a class="tocitem" href="../generated/box/">Box model</a></li><li><a class="tocitem" href="../generated/custom_rule/">Custom rules</a></li></ul></li><li><a class="tocitem" href="../faq/">FAQ</a></li><li><a class="tocitem" href="../api/">API reference</a></li><li><span class="tocitem">Advanced</span><ul><li class="is-active"><a class="tocitem" href>For developers</a><ul class="internal"><li><a class="tocitem" href="#Development-of-Enzyme-and-Enzyme.jl-together-(recommended)"><span>Development of Enzyme and Enzyme.jl together (recommended)</span></a></li><li><a class="tocitem" href="#Development-of-Enzyme-and-Enzyme.jl-together-(manual)"><span>Development of Enzyme and Enzyme.jl together (manual)</span></a></li><li><a class="tocitem" href="#Building-Enzyme-against-Julia&#39;s-LLVM."><span>Building Enzyme against Julia&#39;s LLVM.</span></a></li></ul></li><li><a class="tocitem" href="../internal_api/">Internal API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced</a></li><li class="is-active"><a href>For developers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>For developers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/EnzymeAD/Enzyme.jl/blob/main/docs/src/dev_docs.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Enzyme-developer-documentation"><a class="docs-heading-anchor" href="#Enzyme-developer-documentation">Enzyme developer documentation</a><a id="Enzyme-developer-documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Enzyme-developer-documentation" title="Permalink"></a></h1><h2 id="Development-of-Enzyme-and-Enzyme.jl-together-(recommended)"><a class="docs-heading-anchor" href="#Development-of-Enzyme-and-Enzyme.jl-together-(recommended)">Development of Enzyme and Enzyme.jl together (recommended)</a><a id="Development-of-Enzyme-and-Enzyme.jl-together-(recommended)-1"></a><a class="docs-heading-anchor-permalink" href="#Development-of-Enzyme-and-Enzyme.jl-together-(recommended)" title="Permalink"></a></h2><p>Normally Enzyme.jl downloads and installs <a href="https://github.com/EnzymeAD/enzyme">Enzyme</a> for the user automatically since Enzyme needs to be built against Julia bundeled LLVM. In case that you are making updates to Enzyme and want to test them against Enzyme.jl the instructions below should help you get started.</p><p>Start Julia in your development copy of Enzyme.jl and initialize the deps project</p><pre><code class="language-bash hljs">~/s/Enzyme.jl (master)&gt; julia --project=deps</code></pre><pre><code class="language-julia-repl hljs">julia&gt; # Hit the `]` key to enter package repl.
(deps) pkg&gt; instantiate</code></pre><p>We can now build a custom version of Enzyme for use in Enzyme.jl. To build the latest commit on the main branch of Enzyme, run the following. It may take a few minutes to compile fully.</p><pre><code class="language-bash hljs">~/s/Enzyme.jl (master)&gt; julia --project=deps deps/build_local.jl</code></pre><p>You will now find a file LocalPrefernces.toml which has been generated and contains a path to the new Enzyme_jll binary you have built. To use your Enzyme_jll instead of the default shipped by Enzyme.jl, ensure that this file is at the root of any Julia project you wish to test it with <em>and</em> that the Julia project has Enzyme_jll as an explicit dependency. Note that an indirect dependency here is not sufficient (e.g. just because a project depends on Enzyme.jl, which depends on Enzyme_jll, does not mean that your project will pick up this file unless you also add a direct dependency to Enzyme_jll).</p><p>To test whether your project found the custom version of Enzyme_jll, you can inspect the path of the Enzyme_jll library in use as follows.</p><pre><code class="language-bash hljs">~/my/project.jl (master)&gt; julia --project=.</code></pre><pre><code class="language-julia-repl hljs">julia&gt; using Enzyme_jll
julia&gt; Enzyme_jll.libEnzyme_path
&quot;${JULIA_PKG_DEVDIR}/Enzyme_jll/override/lib/LLVMEnzyme-9.so&quot;</code></pre><p>This should correspond to the path in the LocalPreferences.toml you just generated.</p><p>Note that your system can have only one custom built Enzyme_jll at a time. If you build one version for one version of Enzyme or Julia and later build a new version of Enzyme, it removes the old build. </p><p>Note that Julia versions are tightly coupled and you cannot use an Enzyme_jll built for one version of Julia for another version of Julia.</p><p>The same script can also be used to build Enzyme_jll for a branch other than main as follows.</p><pre><code class="language-bash hljs">~/s/Enzyme.jl (master)&gt; julia --project=deps deps/build_local.jl --branch mybranch</code></pre><p>It can also be used to build Enzyme_jll from a local copy of Enzyme on your machine, which does not need to be committed to git.</p><pre><code class="language-bash hljs">~/s/Enzyme.jl (master)&gt; julia --project=deps deps/build_local.jl ../path/to/Enzyme</code></pre><h2 id="Development-of-Enzyme-and-Enzyme.jl-together-(manual)"><a class="docs-heading-anchor" href="#Development-of-Enzyme-and-Enzyme.jl-together-(manual)">Development of Enzyme and Enzyme.jl together (manual)</a><a id="Development-of-Enzyme-and-Enzyme.jl-together-(manual)-1"></a><a class="docs-heading-anchor-permalink" href="#Development-of-Enzyme-and-Enzyme.jl-together-(manual)" title="Permalink"></a></h2><p>Start Julia in your development copy of Enzyme.jl</p><pre><code class="language-bash hljs">~/s/Enzyme.jl (master)&gt; julia --project=.</code></pre><p>Then create a development copy of Enzyme_jll and activate it within.</p><pre><code class="language-julia-repl hljs">julia&gt; using Enzyme_jll
julia&gt; Enzyme_jll.dev_jll()
[ Info: Enzyme_jll dev&#39;ed out to ${JULIA_PKG_DEVDIR}/Enzyme_jll with pre-populated override directory
(Enzyme) pkg&gt; dev Enzyme_jll
Path `${JULIA_PKG_DEVDIR}/Enzyme_jll` exists and looks like the correct package. Using existing path.</code></pre><p>After restarting Julia:</p><pre><code class="language-julia-repl hljs">julia&gt; Enzyme_jll.dev_jll()
julia&gt; Enzyme_jll.libEnzyme_path
&quot;${JULIA_PKG_DEVDIR}/Enzyme_jll/override/lib/LLVMEnzyme-9.so&quot;</code></pre><p>On your machine <code>${JULIA_PKG_DEVDIR}</code> most likely corresponds to <code>~/.julia/dev</code>. Now we can inspect <code>&quot;${JULIA_PKG_DEVDIR}/Enzyme_jll/override/lib</code> and see that there is a copy of <code>LLVMEnzyme-9.so</code>, which we can replace with a symbolic link or a copy of a version of Enzyme.</p><h2 id="Building-Enzyme-against-Julia&#39;s-LLVM."><a class="docs-heading-anchor" href="#Building-Enzyme-against-Julia&#39;s-LLVM.">Building Enzyme against Julia&#39;s LLVM.</a><a id="Building-Enzyme-against-Julia&#39;s-LLVM.-1"></a><a class="docs-heading-anchor-permalink" href="#Building-Enzyme-against-Julia&#39;s-LLVM." title="Permalink"></a></h2><p>Depending on how you installed Julia the LLVM Julia is using will be different.</p><ol><li>Download from julialang.org (Recommended)</li><li>Manual build on your machine</li><li>Uses a pre-built Julia from your system vendor (Not recommended)</li></ol><p>To check what LLVM Julia is using use:</p><pre><code class="nohighlight hljs">julia&gt; Base.libllvm_version_string
&quot;9.0.1jl&quot;</code></pre><p>If the LLVM version ends in a <code>jl</code> you are likely using the private LLVM.</p><p>In your source checkout of Enzyme:</p><pre><code class="language-bash hljs">mkdir build-jl
cd build-jl</code></pre><h3 id="Prebuilt-binary-from-julialang.org"><a class="docs-heading-anchor" href="#Prebuilt-binary-from-julialang.org">Prebuilt binary from julialang.org</a><a id="Prebuilt-binary-from-julialang.org-1"></a><a class="docs-heading-anchor-permalink" href="#Prebuilt-binary-from-julialang.org" title="Permalink"></a></h3><pre><code class="nohighlight hljs">LLVM_MAJOR_VER=`julia -e &quot;print(Base.libllvm_version.major)&quot;`
julia -e &quot;using Pkg; pkg\&quot;add LLVM_full_jll@${LLVM_MAJOR_VER}\&quot;&quot;
LLVM_DIR=`julia -e &quot;using LLVM_full_jll; print(LLVM_full_jll.artifact_dir)&quot;`
echo &quot;LLVM_DIR=$LLVM_DIR&quot;
cmake ../enzyme/ -G Ninja -DENZYME_EXTERNAL_SHARED_LIB=ON -DLLVM_DIR=${LLVM_DIR} -DLLVM_EXTERNAL_LIT=${LLVM_DIR}/tools/lit/lit.py</code></pre><h3 id="Manual-build-of-Julia"><a class="docs-heading-anchor" href="#Manual-build-of-Julia">Manual build of Julia</a><a id="Manual-build-of-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-build-of-Julia" title="Permalink"></a></h3><pre><code class="nohighlight hljs">cmake ../enzyme/ -G Ninja -DENZYME_EXTERNAL_SHARED_LIB=ON -DLLVM_DIR=${PATH_TO_BUILDDIR_OF_JULIA}/usr/lib/cmake/llvm/</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« API reference</a><a class="docs-footer-nextpage" href="../internal_api/">Internal API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 17 May 2024 23:33">Friday 17 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
